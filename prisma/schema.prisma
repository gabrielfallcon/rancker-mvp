generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tournament {
  id                String     @id @default(uuid())
  name              String
  slug              String     @unique
  description       String?
  startDate         DateTime
  endDate           DateTime
  registrationEndAt DateTime
  bannerImage       String?
  primaryColor      String?
  secondaryColor    String?
  addressName       String?
  addressStreet     String?
  addressCity       String?
  addressState      String?
  addressZip        String?
  latitude          Float?
  longitude         Float?
  createdAt         DateTime   @default(now())
  categories        Category[]
  teams             Team[]
}

model Category {
  id              String         @id @default(uuid())
  name            String
  price           Float
  maxInstallments Int            @default(1)
  maxTeams        Int
  status          CategoryStatus @default(available)
  prizes          Json?
  tournamentId    String
  createdAt       DateTime       @default(now())
  tournament      Tournament     @relation(fields: [tournamentId], references: [id])
  teams           Team[]
}

model Athlete {
  id          String        @id @default(uuid())
  name        String
  email       String        @unique
  instagram   String
  phone       String
  uniformSize String?
  teams       TeamAthlete[]
}

model Team {
  id              String        @id @default(uuid())
  tournamentId    String
  categoryId      String
  stripeSessionId String
  status          TeamStatus
  createdAt       DateTime      @default(now())
  paymentId       String
  category        Category      @relation(fields: [categoryId], references: [id])
  tournament      Tournament    @relation(fields: [tournamentId], references: [id])
  athletes        TeamAthlete[]

  @@index([stripeSessionId])
}

model TeamAthlete {
  id        String  @id @default(uuid())
  teamId    String
  athleteId String
  athlete   Athlete @relation(fields: [athleteId], references: [id])
  team      Team    @relation(fields: [teamId], references: [id])

  @@unique([teamId, athleteId])
}

model Payment {
  id           String   @id
  provider     String
  status       String
  amount       Float
  tournamentId String
  athleteEmail String
  createdAt    DateTime @default(now())
}

enum TeamStatus {
  pending
  paid
  cancelled
}

enum UniformSize {
  PP
  P
  M
  G
  XG
}

enum CategoryStatus {
  available
  last_spots
  sold_out
  in_progress
}
